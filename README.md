# Deploy a Pentest Lab with GitOps

## Description
This is a Git repository to automate the deployment of a pentest lab with Ansible and GitLab CI/CD for the following infrastructure: ![Lab Design](design.png)

## Stages
- **caserver**: Execute the playbook [create_certificates.yml](playbooks/create_certificates.yml) to create all the certficates and keys required for the VPN configuration.
- **vpnservser**: Execute the playbook [config_vpnserver.yml](playbooks/config_vpnserver.yml) to configure OpenVPN and UFW firewall on the VPN server.
- **clients**: Execute the playbook [config_clients.yml](playbooks/config_clients.yml) to generate configuration files for multiple clients based on the list of clients specified in [playbooks\roles\caserver\defaults\main.yml](playbooks\roles\caserver\defaults\main.yml)
- **backend**: Execute the playbook [config_backend.yml](playbooks/config_backend.yml) to install docker and start containers for the lab based on docker compose files stored in [playbooks/files/pentest-lab](playbooks/files/pentest-lab)

## Usage
Upload the content of this repository to a GitLab project and create the following secret variables:
- `ANSIBLE_CFG`: (type: File) is the content of the Ansible configuration file. Example:
    ```
    [defaults]
    remote_user = vagrant
    host_key_checking = False
    ```
    - `remote_user` specify the user ansible will use to access the target machines. The target machines should be preconfigured with the public ssh key for this user.
    - `host_key_checking` is set to false to ignore prompt for known hosts

- `ANSIBLE_INVENTORY`: (type: File) is the content of the Ansible inventory file. This file should be stored as a secret variable in the GitLab project. Example:
    ```
    [vpnserver]
    10.0.0.11

    [backend]
    10.0.0.12
    ```

- `SSH_PRIVATE_KEY` (type: File) is the private key for the user specified in the Ansible configuration file. This key should also be stored as a secret variable.